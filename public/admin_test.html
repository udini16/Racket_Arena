<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Panel - Racket Arena</title>
    <style>
        body { font-family: system-ui, sans-serif; max-width: 900px; margin: 40px auto; padding: 20px; background: #111827; color: #fff; }
        .box { background: #1f2937; padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #374151; }
        h2 { margin-top: 0; color: #60a5fa; border-bottom: 1px solid #374151; padding-bottom: 10px; }
        input { background: #374151; border: 1px solid #4b5563; color: white; padding: 10px; width: 100%; border-radius: 6px; box-sizing: border-box; margin-bottom: 10px; }
        button { padding: 10px 20px; cursor: pointer; border-radius: 6px; border: none; font-weight: bold; color: white; }
        .btn-blue { background: #2563eb; } .btn-red { background: #dc2626; } .btn-green { background: #059669; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .stat-card { background: #111827; padding: 15px; border-radius: 8px; text-align: center; }
        .stat-number { font-size: 2rem; font-weight: bold; color: #34d399; }
        .court-item { display: flex; justify-content: space-between; align-items: center; background: #111827; padding: 10px; margin-bottom: 5px; border-radius: 6px; }
        pre { background: #000; padding: 10px; border-radius: 6px; overflow: auto; }
    </style>
</head>
<body>
    <h1>üõ°Ô∏è Admin Dashboard</h1>

    <!-- 1. LOGIN (Need to get Admin Token first) -->
    <div id="loginBox" class="box">
        <h2>1. Admin Login</h2>
        <input type="email" id="email" placeholder="Admin Email" value="izzuddin0@gmail.com">
        <input type="password" id="password" placeholder="Password">
        <button class="btn-blue" onclick="login()">Login as Admin</button>
    </div>

    <!-- DASHBOARD (Hidden until logged in) -->
    <div id="dashboard" style="display:none;">
        
        <!-- Stats Section -->
        <div class="box">
            <h2>üìä Live Statistics</h2>
            <div class="grid" id="statsGrid">
                <!-- Stats will load here -->
            </div>
            <button class="btn-green" style="margin-top:10px" onclick="loadStats()">Refresh Stats</button>
        </div>

        <div class="grid">
            <!-- Add Court -->
            <div class="box">
                <h2>‚ûï Add New Court</h2>
                <input type="text" id="courtName" placeholder="Court Name (e.g. VIP Court)">
                <button class="btn-blue" onclick="addCourt()">Create Court</button>
            </div>

            <!-- List Courts -->
            <div class="box">
                <h2>üè∏ Manage Courts</h2>
                <div id="courtList">Loading...</div>
                <button class="btn-green" style="margin-top:10px" onclick="loadCourts()">Refresh List</button>
            </div>
        </div>

        <div class="box">
            <h2>Console Log</h2>
            <pre id="output">...</pre>
        </div>
    </div>

    <script>
        let token = null;

        async function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            const res = await fetch('/api/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
                body: JSON.stringify({ email, password })
            });
            const data = await res.json();
            
            if (data.token) {
                token = data.token;
                document.getElementById('loginBox').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                loadStats();
                loadCourts();
            } else {
                alert('Login Failed: ' + data.message);
            }
        }

        async function loadStats() {
            const res = await fetch('/api/admin/stats', {
                headers: { 'Authorization': 'Bearer ' + token, 'Accept': 'application/json' }
            });
            const json = await res.json();
            
            // Build Stats UI
            const stats = json.data;
            let html = '';
            for (const [key, value] of Object.entries(stats)) {
                html += `
                    <div class="stat-card">
                        <div style="color:#9ca3af; text-transform:uppercase; font-size:0.8rem">${key.replace('_', ' ')}</div>
                        <div class="stat-number">${value}</div>
                    </div>
                `;
            }
            document.getElementById('statsGrid').innerHTML = html;
        }

        async function addCourt() {
            const name = document.getElementById('courtName').value;
            const res = await fetch('/api/courts', {
                method: 'POST',
                headers: { 
                    'Authorization': 'Bearer ' + token,
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify({ name: name, is_active: true })
            });
            const data = await res.json();
            document.getElementById('output').innerText = JSON.stringify(data, null, 2);
            loadCourts(); // Refresh list
        }

        async function deleteCourt(id) {
            if(!confirm('Are you sure you want to delete this court?')) return;

            const res = await fetch('/api/courts/' + id, {
                method: 'DELETE',
                headers: { 
                    'Authorization': 'Bearer ' + token,
                    'Accept': 'application/json'
                }
            });
            loadCourts(); // Refresh list
        }

        async function loadCourts() {
            const res = await fetch('/api/courts');
            const json = await res.json();
            
            let html = '';
            json.data.forEach(court => {
                html += `
                    <div class="court-item">
                        <span>${court.name} (ID: ${court.id})</span>
                        <button class="btn-red" style="padding:5px 10px; font-size:0.8rem" onclick="deleteCourt(${court.id})">Delete</button>
                    </div>
                `;
            });
            document.getElementById('courtList').innerHTML = html;
        }
    </script>
</body>
</html>